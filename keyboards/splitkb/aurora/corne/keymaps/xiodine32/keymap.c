#include QMK_KEYBOARD_H

enum layer_names { _BASE, _NUM, _SYM, _FUN };

#define SM_LSFT OSM(MOD_LSFT)
#define SM_RSFT OSM(MOD_RSFT)
#define SM_LCTL OSM(MOD_LCTL)
#define SM_RCTL OSM(MOD_RCTL)
#define SM_LALT OSM(MOD_LALT)
#define SM_RALT OSM(MOD_RALT)
#define SM_LGUI OSM(MOD_LGUI)
#define SM_RGUI OSM(MOD_RGUI)

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_BASE] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
       KC_TAB,    KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                         KC_Y,    KC_U,    KC_I,    KC_O,   KC_P,  KC_BSPC,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LCTL,    KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                         KC_H,    KC_J,    KC_K,    KC_L, KC_SCLN, KC_QUOT,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LSFT,    KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,                         KC_N,    KC_M, KC_COMM,  KC_DOT, KC_SLSH,  KC_ESC,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          KC_LGUI,MO(_NUM),  KC_SPC,     KC_ENT,MO(_SYM), KC_RALT
                                      //`--------------------------'  `--------------------------'
  ),

    [_NUM] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
      _______,    KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                         KC_6,    KC_7,    KC_8,    KC_9,    KC_0, _______,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, SM_LGUI, SM_LALT, SM_LCTL, SM_LSFT, XXXXXXX,                      KC_LEFT, KC_DOWN,   KC_UP,KC_RIGHT,  KC_DEL, CW_TOGG,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      KC_HOME, KC_PGDN, KC_PGUP,  KC_END,  KC_INS, _______,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          _______, _______, _______,    _______, _______, _______
                                      //`--------------------------'  `--------------------------'
  ),

    [_SYM] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
      _______, KC_EXLM,   KC_AT, KC_HASH,  KC_DLR, KC_PERC,                      KC_CIRC, KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, _______,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, SM_LGUI, SM_LALT, SM_LCTL, SM_LSFT, XXXXXXX,                      KC_MINS,  KC_EQL, KC_BSLS, KC_LBRC, KC_RBRC,  KC_GRV,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, KC_MPRV, KC_VOLD, KC_VOLU, KC_MNXT, KC_MPLY,                      KC_UNDS, KC_PLUS, KC_PIPE, KC_LCBR, KC_RCBR, KC_TILD,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          _______, _______, _______,    _______, _______, _______
                                      //`--------------------------'  `--------------------------'
  ),

    [_FUN] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
        KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,                        KC_F7,   KC_F8,   KC_F9,  KC_F10,  KC_F11,  KC_F12,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, SM_LGUI, SM_LALT, SM_LCTL, SM_LSFT, XXXXXXX,                      KC_MS_L, KC_MS_D, KC_MS_U, KC_MS_R, XXXXXXX, KC_CAPS,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      _______, RGB_MOD, RGB_HUI, RGB_SAI, RGB_VAI, RGB_SPI,                      KC_BTN1, KC_WH_D, KC_WH_U, KC_BTN2, XXXXXXX, QK_BOOT,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          _______, _______, _______,    _______, _______, _______
                                      //`--------------------------'  `--------------------------'
  )
};
// clang-format on

void keyboard_pre_init_user(void) {
    // Set our LED pin as output
    setPinOutput(24);
    // Turn the LED off
    // (Due to technical reasons, high is off and low is on)
    writePinHigh(24);
}

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, _NUM, _SYM, _FUN);
}

static void render_xio_art(void) {
    // clang-format off
    static const char PROGMEM xio_art[] = {
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,254, 62, 30, 30, 30, 30,158,158,222, 94, 94, 94, 94, 94, 94,222,158,158, 30, 30, 30, 30, 62,254,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,240,252,254,255,195,193,192,192,192,192,192,192,192,192,193,195,255,254,252,240,  0,  0,  0,  0,  0,  0,
        0,  0,  0,192,  0,  0,  7, 63,127,255,195,131,  3,  3,  3,  3,  3,  3,  3,  3,131,195,255,127, 63, 15,  0,  0,192,  0,  0,  0,  0,  0,  0,127,126,124,120,120,120,120,121,121,123,122,122,122,122,122,122,123,123,121,120,120,120,120,124,126,127,  0,  0,  0,254,252,248,248,240,240,224,224,224,224,224,192,192,192,192,192,192,192,192,192,192,224,224,224,224,192,176,224, 64,144,136, 96,127, 79, 63, 39, 79,159, 51, 39,207, 27, 71, 19,155,103, 39,155,247,103,155,247,231,155,231,215,155,107,
        63,103,223,191,190,254,129, 36,  1,  8,130,  0, 96,  2,  8, 32,  2,136,145,132,131,139, 14, 63, 63,127,255,255,255,127,255,254,253,241, 78, 25,177,198,248,224,129,  0,  8, 38,  0, 64,252,254,251,249,128,  0,  0,  0,  0,  1,  0,224,  0,  0,  9,  0,  0,227,255,249,254,243, 68,  0,255,253,237,146, 98,200,  1,160,129,  3,131,129,  0,128,128,128,192,192,208,224,224,242,248,254,255,255,255,255,127, 63, 31,  4,  3,  1,  7,  7, 14,155,142, 52, 29,217, 62,254,231,159, 31, 31,199, 15, 15, 15, 15, 15, 15,  7,  7,  3,
        1,  4,  8,144, 32,136,248,249,188,154, 22,111,143, 17, 55,  4, 15, 39, 31, 25, 30, 63, 63, 63,127,254,255,253,254,254,249,242,217,228,178,128,  0,  3,255,191, 55,  4,  9,194,  0,  0,240,248,252,240, 64,  0,  0,  0,  0,  0, 34,192,  0,  3, 39, 15, 63,255,255,255,255,255, 31,  0, 64,  4, 32,  0,  2, 12, 48,  1, 67, 15,143, 27, 16, 48,  0,144,160,160,136,224,240,248,242,224,248,253,255, 63,103, 72, 27,132,176,230,136,160, 33,  8,224, 33,  8,194, 16,132, 41,105,198, 31,255,255,127,127,255,127,255,191,
        63,207,177,115,204,156,115,204
    };
    // clang-format on
    oled_write_raw_P(xio_art, sizeof(xio_art));
    oled_set_cursor(0, 0);
};
static void render_pinkfloyd_art(void) {
    // clang-format off
    static const char PROGMEM pinkfloyd_art[] = {
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 64,176,238, 91,245,222,255,125,255, 21,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 64,176,255,173,247,221,255,255,255,255,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 64,176,255,191,106,223,250,255,127,223, 63,  0,  0,  0,  0,  0,  0,  0,128,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 52, 27, 23,138,  7,201,135, 65, 98, 33, 16, 24,  8,  4,  4,  2,  2,  1,171,  0,  0,  0,128, 64,128, 64, 32, 48, 16,  8, 20,  8,134,  6,130,  1, 65,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,170,  0,
        0,  1,  1,  3,  4,  4, 10,  8, 16, 16, 48,101,250,173,138,130,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,170,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 64,  1,  2,  3,  4,  6,  8,  8, 24, 32, 48, 64, 64,128,128,  0,170,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10,160,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10,160,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  4, 16,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    };
    // clang-format on
    oled_write_raw_P(pinkfloyd_art, sizeof(pinkfloyd_art));
    oled_set_cursor(0, 0);
}
static void render_wmp(void) {
    static char wpm_str[6];
    sprintf(wpm_str, " %03d ", get_current_wpm());
    oled_write(wpm_str, false);
}

bool oled_task_user(void) {
    oled_set_brightness(1);
    if (is_keyboard_master()) {
        render_pinkfloyd_art();
        render_wmp();
    } else {
        render_xio_art();
        oled_write_P(PSTR(" xio "), false);
    }
    return false;
}
